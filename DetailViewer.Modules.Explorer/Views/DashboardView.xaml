<UserControl
    x:Class="DetailViewer.Modules.Explorer.Views.DashboardView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:DetailViewer.Modules.Explorer.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:DetailViewer.Core.Models;assembly=DetailViewer.Core"
    xmlns:prism="http://prismlibrary.com/"
    d:DesignHeight="600"
    d:DesignWidth="1450"
    prism:ViewModelLocator.AutoWireViewModel="True"
    Background="{StaticResource BackgroundLightBrush}"
    mc:Ignorable="d">
    <UserControl.Resources>
        <converters:EnumToBooleanConverter x:Key="EnumToBooleanConverter" />
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!--  1. Панель инструментов  -->
        <ToolBar Grid.Row="0" Padding="5">
            <Button Command="{Binding FillFormCommand}" Style="{StaticResource ToolBarButtonStyle}">
                <StackPanel Orientation="Horizontal">
                    <ContentControl
                        Width="16"
                        Height="16"
                        Margin="0,0,5,0"
                        Content="{StaticResource IconAdd}" />
                    <TextBlock VerticalAlignment="Center" Text="Заполнить форму" />
                </StackPanel>
            </Button>

            <Button Command="{Binding FillBasedOnCommand}" Style="{StaticResource ToolBarButtonStyle}">
                <StackPanel Orientation="Horizontal">
                    <ContentControl
                        Width="16"
                        Height="16"
                        Margin="0,0,5,0"
                        Content="{StaticResource IconCopy}" />
                    <TextBlock VerticalAlignment="Center" Text="Заполнить на основании" />
                </StackPanel>
            </Button>

            <Button Command="{Binding EditRecordCommand}" Style="{StaticResource ToolBarButtonStyle}">
                <StackPanel Orientation="Horizontal">
                    <ContentControl
                        Width="16"
                        Height="16"
                        Margin="0,0,5,0"
                        Content="{StaticResource IconEdit}" />
                    <TextBlock VerticalAlignment="Center" Text="Изменить" />
                </StackPanel>
            </Button>

            <Button Command="{Binding DeleteRecordCommand}" Style="{StaticResource ToolBarButtonStyle}">
                <StackPanel Orientation="Horizontal">
                    <ContentControl
                        Width="16"
                        Height="16"
                        Margin="0,0,5,0"
                        Content="{StaticResource IconDelete}" />
                    <TextBlock VerticalAlignment="Center" Text="Удалить" />
                </StackPanel>
            </Button>

            
        </ToolBar>

        <!--  2. Панель фильтров  -->
        <Grid Grid.Row="1" Margin="5,0,5,5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="120" />
                <ColumnDefinition Width="150" />
                <ColumnDefinition Width="100" />
                <ColumnDefinition Width="200" />
                <ColumnDefinition Width="150" />
                <ColumnDefinition Width="200" />
                <ColumnDefinition Width="150" />
                <ColumnDefinition Width="200" />
                <ColumnDefinition Width="150" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <StackPanel Grid.Column="0" Orientation="Vertical">
                <TextBlock Text="Фильтры:" VerticalAlignment="Center" Margin="0,0,0,5"/>
                <DatePicker SelectedDate="{Binding SelectedDate, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,5,0"/>
            </StackPanel>
            <TextBox
                Grid.Column="1"
                Margin="0,0,5,0"
                Height="32" VerticalAlignment="Bottom"
                Text="{Binding EskdNumberFilter, UpdateSourceTrigger=PropertyChanged}" />
            <TextBox
                Grid.Column="2"
                Margin="0,0,5,0"
                Height="32" VerticalAlignment="Bottom"
                Text="{Binding YastCodeFilter, UpdateSourceTrigger=PropertyChanged}" />
            <TextBox
                Grid.Column="3"
                Margin="0,0,5,0"
                Height="32" VerticalAlignment="Bottom"
                Text="{Binding NameFilter, UpdateSourceTrigger=PropertyChanged}" />
            <TextBox
                Grid.Column="4"
                Margin="0,0,5,0"
                Height="32" VerticalAlignment="Bottom"
                Text="{Binding AssemblyNumberFilter, UpdateSourceTrigger=PropertyChanged}" />
            <TextBox
                Grid.Column="5"
                Margin="0,0,5,0"
                Height="32" VerticalAlignment="Bottom"
                Text="{Binding AssemblyNameFilter, UpdateSourceTrigger=PropertyChanged}" />
            <TextBox
                Grid.Column="6"
                Margin="0,0,5,0"
                Height="32" VerticalAlignment="Bottom"
                Text="{Binding ProductNumberFilter, UpdateSourceTrigger=PropertyChanged}" />
            <TextBox
                Grid.Column="7"
                Margin="0,0,5,0"
                Height="32" VerticalAlignment="Bottom"
                Text="{Binding ProductNameFilter, UpdateSourceTrigger=PropertyChanged}" />
            <StackPanel Grid.Column="8" Orientation="Vertical">
                <ComboBox
                    Margin="0,0,5,5"
                    ItemsSource="{Binding UniqueFullNames}"
                    SelectedItem="{Binding SelectedFullName}" />
                <CheckBox
                    Margin="7,0,0,0"
                    VerticalAlignment="Center"
                    Content="Только мои"
                    IsChecked="{Binding OnlyMyRecordsFilter}" />
            </StackPanel>
        </Grid>

        <!--  3. Основная рабочая область  -->
        <Grid Grid.Row="2" Margin="5,0,5,5">
            <DataGrid ItemsSource="{Binding DocumentRecords}" SelectedItem="{Binding SelectedRecord}">
                <DataGrid.Columns>
                    <DataGridTextColumn
                        Width="120"
                        Binding="{Binding Date, StringFormat='{}{0:dd.MM.yyyy}'}"
                        Header="Дата" />
                    <DataGridTextColumn
                        Width="150"
                        Binding="{Binding ESKDNumber.FullCode}"
                        Header="ЕСКД номер" />
                    <DataGridTextColumn
                        Width="100"
                        Binding="{Binding YASTCode}"
                        Header="ЯСТ код" />
                    <DataGridTextColumn
                        Width="200"
                        Binding="{Binding Name}"
                        Header="Имя" />
                    <DataGridTextColumn
                        Width="150"
                        Binding="{Binding AssemblyNumber}"
                        Header="Номер сборки" />
                    <DataGridTextColumn
                        Width="200"
                        Binding="{Binding AssemblyName}"
                        Header="Имя сборки" />
                    <DataGridTextColumn
                        Width="150"
                        Binding="{Binding ProductNumber}"
                        Header="Номер продукта" />
                    <DataGridTextColumn
                        Width="200"
                        Binding="{Binding ProductName}"
                        Header="Имя продукта" />
                    <DataGridTextColumn
                        Width="150"
                        Binding="{Binding FullName}"
                        Header="ФИО" />
                </DataGrid.Columns>
            </DataGrid>
        </Grid>

        <!--  4. Статус бар  -->
        <StatusBar Grid.Row="3">
            <StatusBarItem>
                <TextBlock Text="{Binding StatusText}" />
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <ProgressBar
                    Width="100"
                    Height="15"
                    IsIndeterminate="True"
                    Visibility="{Binding IsBusy, Converter={StaticResource BooleanToVisibilityConverter}}" />
            </StatusBarItem>
        </StatusBar>
    </Grid>
</UserControl>